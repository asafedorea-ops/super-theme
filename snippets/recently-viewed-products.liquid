<!-- start recently-viewed-products.liquid (SNIPPET) -->
{%- assign enabled = false -%}

{%- if template contains 'index' -%}
    {%- assign enabled = true -%}
{%- elsif template contains 'collection' -%}
    {%- assign enabled = true -%}
{%- elsif template contains 'product' -%}
    {%- assign enabled = true -%}
{%- endif -%}

{%- if enabled -%}
<div class="shopify-section recently-viewed-products hide" data-section-type="recently-viewed-products">
    <section class="wrapper" data-section-type="product-recently-viewed">
        <header class="section-header">
            <h2 id="recently-viewed-products-title" class="title-recently section-title {{ settings.recently_viewed_section_title_text_transform }}">{{ settings.recently_viewed_section_title | default: 'Recently Viewed Products' }}</h2>
        </header>
        <ul id="recently-viewed-products" class="grid-uniform grid-uniform--s4" data-price="true" data-compare-price="true"></ul>
    </section>
</div>
<script>
    var recently_tags = {
        product_badge_tag:"{{ settings.product_badge_tag }}",
        product_badge_text_tag:"{{ settings.product_badge_text_tag }}",
        position_product_tag_badge:"{{ settings.position_product_tag_badge }}",
        out_of_stock_label:"{{ settings.enable_out_of_stock_button }}"
    }
</script>

{% raw %}
<script id="recently-viewed-product-template"  type="text/x-jquery-tmpl">
    <li class="grid__item" data-handle="${handle}">
        {{if tags}}
            {{each(i) tags}}
                {{if tags[i].toString() === recently_tags.product_badge_tag && recently_tags.product_badge_text_tag !== ''}}
                <label class="product_tag_badge ribbon ${recently_tags.position_product_tag_badge} ">
                    <span>${recently_tags.product_badge_text_tag}</span>
                </label>
                {{/if}}
            {{/each}}
        {{/if}}
        <a href="${url}" class="grid-product-link">
            <div class="grid__item-image-wrapper">
                <img
                    width="300"
                    height="300"
                    class="grid__item-image"
                    data-srcset="https:${Shopify.Products.resizeImage(featured_image,"1300x")} 1200w,https:${Shopify.Products.resizeImage(featured_image,"1000x")} 900w,https:${Shopify.Products.resizeImage(featured_image,"800x")} 700w,https:${Shopify.Products.resizeImage(featured_image,"600x")} 500w,https:${Shopify.Products.resizeImage(featured_image,"500x")} 400w,https:${Shopify.Products.resizeImage(featured_image,"400x")} 300w"
                    data-widths="[180,360,540,720,900,1080,1296,1512,1728,1944,2160,2376,2592,2808,3024]"
                    data-sizes="auto"
                    src="${featured_image||product_without_image}"
                    alt="${title}""
                    />
                </div>
            <h4 class="grid__item-title">
                {{html title}}
            </h4>

            <div class="grid__item-price-wrapper">
                {{if compare_at_price > price}}
                <span class="grid__item-compare-at-price">{{html (compare_at_price) ? VastaShop.formatMoney(compare_at_price) : ''}}</span>
                {{/if}}

                <span class="grid__item-price">{{html VastaShop.formatMoney(price)}}</span>

                {{if !available && recently_tags.out_of_stock_label == 'true'}}1,2,3
                    <span class="grid__item-sold-out">
                        {% endraw %}
                        {{ settings.unavailable_product_label | default: '(Out Of Stock)' }}
                        {% raw %}
                    </span>
                {{/if}}
            </div>
        </a>
    </li>
</script>
{% endraw %}
{%- endif -%}



<!-- End Recently Viewed Products -->