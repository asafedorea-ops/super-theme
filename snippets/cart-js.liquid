<!-- start cart-js.liquid (SNIPPET) -->
<script>
    (function($){
    // var product_itemLabel = '{{ "products.product.item" | t }}';
    // var product_itemsLabel = '{{ "products.product.items" | t }}';

    var enable_freeshipping_msg = enable_freeshipping_msg || {{ settings.enable_freeshipping_msg | default: false }};
    var freeshipping_msg = freeshipping_msg || '{{ settings.freeshipping_msg }}';

    if (typeof cart_page !== 'undefined' && cart_page) {
        cart_page.text_cart_above_button = "{{ settings.text_cart_above_button | replace: '"', '\"' }}";
        cart_page.enable_week_message = {{ settings.enable_day_on_message }};
    }

    window.addEventListener('load', function(){
        jQuery(document).on('submit','.jq-remove-cart-item', function(){
            var data = jQuery(this).serialize();

            jQuery('#jq-cart-item-' + get_id_variant(data) +' .bt-remove-cart').html(loading());

            VastaShop.Cart.update(data).then(function(cart, response){
                loadPage(cart, response);
            }).catch(function(err) {
                console.log(err);

            });
            return false;
        });

        /**
        * Increases Amount Items Cart
        * @function[<plus-cart-item>]
        *
        * This function increases the quantity of the product in the cart
        *
        * Dependencies: none
        *
        * @param: none
        *
        */
        $(document).on('click', '.jq-plus-cart-item', function(){
            var input_qtd =  $(this).siblings('.jq-input-qtd');
            input_qtd.siblings('.btn-plus').removeAttr('disabled');
            input_qtd.siblings('.btn-minus').removeAttr('disabled');
            input_qtd.removeAttr('disabled');

            if(input_qtd.attr('data-max') == -1){
                input_qtd.val(parseInt(input_qtd.val()) + 1);
            }else if(input_qtd.val() >= parseInt(input_qtd.attr('data-max'))){
                input_qtd.val(parseInt(input_qtd.attr('data-max')));
                input_qtd.siblings('.btn-plus').attr('disabled','disabled');
                input_qtd.attr('disabled','disabled');
             }else if(input_qtd.val() < parseInt(input_qtd.attr('data-max')) ){
                input_qtd.val(parseInt(input_qtd.val()) + 1);
            }
        });

        /**
        * Edit Quantity Items Cart
        * @function[<input-qtd-cart>]
        *
        * This function edits the quantity of the product in the cart
        *
        * Dependencies: none
        *
        * @param: none
        *
        */
       $(document).on('blur', '.jq-input-qtd', function(){
        var input_qtd =  $(this);
        input_qtd.siblings('.btn-plus').removeAttr('disabled');
        input_qtd.siblings('.btn-minus').removeAttr('disabled');
        input_qtd.removeAttr('disabled');
        if(input_qtd.val() < 1){
          input_qtd.val(1);
          input_qtd.siblings('.btn-minus').attr('disabled','disabled');
        }else if(input_qtd.val() >= parseInt(input_qtd.attr('data-max')) && parseInt(input_qtd.attr('data-max')) != -1){
          input_qtd.val(parseInt(input_qtd.attr('data-max')));
          input_qtd.siblings('.btn-plus').attr('disabled','disabled');
          input_qtd.attr('disabled','disabled');
        }
        $('.jq-qtd-item-cart').submit();
      });

        /**
        * Decrease Quantity Items Cart
        * @function[<minus-cart-item>]
        *
        * This function decreases the quantity of the product in the carton
        *
        * Dependencies: none
        *
        * @param: none
        *
        */
        $(document).on('click', '.jq-minus-cart-item', function(){
            var input_qtd =  $(this).siblings('.jq-input-qtd');
            input_qtd.siblings('.btn-plus').removeAttr('disabled');
            input_qtd.removeAttr('disabled');
            if(input_qtd.val() > 1){
                input_qtd.val(parseInt(input_qtd.val()) - 1);
            }else{
                 input_qtd.siblings('.btn-minus').attr('disabled','disabled');
            }
        });

        /**
        * Updates Value Item Cart
        * @function[<qtd-item-cart>]
        *
        * This function updates the quantity of the product in the cart
        *
        * Dependencies: none
        *
        * @param: none
        *
        * @return false
        */
        $(document).on('submit', '.jq-qtd-item-cart', function(){
            var data = $(this).serialize(),
            quantity = $(this).find('.input-qtd').eq(0).val(),
			itemPrice = $(this).find('.input-qtd');

            VastaShop.Cart.update(data).then(function(cart, response){
                loadPage(cart, response);
            }).catch(function(err) {
                console.log(err);

            });
            return false;
        });

        {% if template contains 'cart' %} 
            async function loadPage(cart,response) {
                var htmldoc = await $.get(location.pathname);
                var parser = new DOMParser();
                htmlDoc = parser.parseFromString(htmldoc,"text/html");
                const itemList = htmlDoc.querySelector('#ajax_cart');
                $('#ajax_cart').html(itemList);

                if(response === "success") {
                    if (shipping_bar.enable_discount || shipping_bar.style_shipping == "dicount_style") {
                        update_shipping_bar(cart);
                    }
                    update_discount_cart(cart.total_price,cart.item_count);
                }
              
            }
            
        {% endif %}
  
    });
})(jQuery);


</script>

