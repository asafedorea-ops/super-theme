<link data-href="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css">
{{ 'section-reviews.css' | asset_url | stylesheet_tag }}

{% if section.settings.enable_reviews %}
  <!-- start reviews.liquid (SECTION) - DOM legado preservado para VastaShop.js -->
  {%- liquid
    assign bg_style = section.settings.background_style
    assign bg_color = section.settings.background_color
    assign grad_start = section.settings.gradient_start
    assign grad_end = section.settings.gradient_end
    assign fallback_assets = 'logitech-white.png,logitech-black.png,logitech-red.png' | split: ','
  -%}
  <section
    data-section-type="reviews"
    id="slider-reviews-{{ section.id }}"
    data-slider="{{ section.id }}"
    class="reviews reviews-premium reviews-sm-desktop reviews-tablet reviews-mobile reviews-sm-mobile {{ section.settings.custom_class }}"
    style="
      --reviews-premium-bg: {{ bg_color }};
      --reviews-premium-gradient-start: {{ grad_start }};
      --reviews-premium-gradient-end: {{ grad_end }};
    "
    data-background-style="{{ bg_style }}"
  >
    <h3 class="hide">Reviews</h3>
    <div class="reviews-content">
      <div class="wrapper reviews-premium__container">
        <header class="reviews-premium__header">
          {%- if section.settings.section_title != blank -%}
            <h2 class="reviews-premium__title section-title">{{ section.settings.section_title | escape }}</h2>
          {%- endif -%}
          {%- if section.settings.section_subtitle != blank -%}
            <p class="reviews-premium__subtitle">{{ section.settings.section_subtitle | escape }}</p>
          {%- endif -%}
        </header>

        <div
          id="slider-{{ section.id }}"
          class="slick-slider reviews-premium__slider reviews__slider"
          data-autoplay="{{ section.settings.slider_autoplay }}"
          data-speed="{{ section.settings.slider_speed }}"
        >
          {%- if section.blocks.size == 0 -%}
            <div class="reviews-premium__empty" {{ section.shopify_attributes }}>
              <p>Add a review card above to show customer reviews here.</p>
            </div>
          {%- endif -%}
          {%- for block in section.blocks -%}
            {%- liquid
              assign is_review = false
              assign is_select = false
              if block.type == 'review'
                assign is_review = true
              elsif block.type == 'select'
                assign is_select = true
              endif
            -%}
            {%- if is_review or is_select -%}
              {%- liquid
                assign loop_index = forloop.index0 | modulo: 3
                assign img_fallback = fallback_assets[loop_index]
                if is_review
                  assign card_text = block.settings.review_text
                  assign card_author = block.settings.review_author
                  assign card_verified = block.settings.review_verified_label
                  assign card_stars = block.settings.manual_stars_value | default: 5 | round | at_least: 0 | at_most: 5
                  assign card_product = block.settings.product
                  assign card_image = block.settings.review_product_image
                else
                  assign card_text = block.settings.content_review
                  assign card_author = block.settings.author_review
                  assign card_verified = 'Verified Purchase'
                  assign card_stars = block.settings.stars_review | default: 5 | plus: 0 | at_least: 1 | at_most: 5
                  assign card_product = block.settings.product
                  assign card_image = block.settings.product_image
                endif
                assign default_names = 'Sarah M.,James K.,Emily R.' | split: ','
                assign display_author = card_author | default: default_names[loop_index]
                assign default_reviews = 'Best mouse I have ever owned. The build quality is outstanding and it is incredibly comfortable for all-day use.|Fast shipping and the product exceeded my expectations. Highly recommend for anyone who works from home.|Worth every penny. Smooth tracking, great battery life, and the design looks premium on my desk.' | split: '|'
                assign use_default_text = false
                if card_text == blank or card_text contains 'Lorem' or card_text contains 'lorem'
                  assign use_default_text = true
                endif
                assign display_text = card_text
                if use_default_text
                  assign display_text = default_reviews[loop_index]
                endif
              -%}
              <div class="slick-content reviews-premium__card reviews__item" {{ block.shopify_attributes }}>
                <div class="reviews-premium__image img-reviews">
                  {%- if card_image != blank -%}
                    <img
                      src="{{ card_image | image_url: width: 500 }}"
                      alt="{{ card_author | default: 'Review' | escape }}"
                      width="300"
                      height="300"
                      loading="lazy"
                    >
                  {%- else -%}
                    <img
                      src="{{ img_fallback | asset_url }}"
                      alt="{{ card_author | default: 'Review' | escape }}"
                      width="300"
                      height="300"
                      loading="lazy"
                    >
                  {%- endif -%}
                </div>

                <div class="reviews-premium__content text-reviews">
                  <div class="reviews-premium__author-name athor-reviews">
                    <strong>{{ display_author }}</strong>
                  </div>
                  <div class="reviews-premium__stars star-reviews">
                    {%- if settings.app_review != blank and settings.app_review != 'none' and card_product != blank -%}
                      {%- render 'reviews-stars', product: card_product, show_label: false -%}
                    {%- else -%}
                      <span class="reviews-premium__stars-manual" aria-label="{{ card_stars }} de 5 estrelas">
                        {%- for i in (1..5) -%}
                          {%- if i <= card_stars -%}★{%- endif -%}
                        {%- endfor -%}
                      </span>
                    {%- endif -%}
                  </div>

                  {%- if display_text != blank -%}
                    <div class="reviews-premium__text">
                      {%- if use_default_text -%}
                        <p>{{ display_text }}</p>
                      {%- else -%}
                        {{ display_text }}
                      {%- endif -%}
                    </div>
                  {%- endif -%}

                  <div class="reviews-premium__author athor-reviews">
                    {%- if card_verified != blank -%}
                      <span class="reviews-premium__verified">
                        <span class="reviews-premium__verified-icon" aria-hidden="true">{%- render 'icon-check' -%}</span>
                        {{ card_verified }}
                      </span>
                    {%- endif -%}
                  </div>
                </div>
              </div>
            {%- endif -%}
          {%- endfor -%}
        </div>
      </div>
    </div>
  </section>
{% endif %}

<script type="lazyload_int">
  setTimeout(function () {
    window.SectionReviews = (function () {
      function SectionReviews() {
        this.settings = {
          slidesToShow: 3,
          slidesToScroll: 1,
          autoplay: true,
          autoplaySpeed: 2000,
          arrows: false,
          responsive: [
            { breakpoint: 1280, settings: { slidesToShow: 3, slidesToScroll: 1 } },
            { breakpoint: 1019, settings: { slidesToShow: 3, slidesToScroll: 1 } },
            { breakpoint: 767, settings: { slidesToShow: 1, slidesToScroll: 1 } },
          ],
        };
        this._run();
      }
      SectionReviews.prototype = {
        onLoad: function () { this._run(); },
        _run: function () {
          var settings = this.settings;
          jQuery('[id^="slider-reviews-"]').each(function () {
            var $section = jQuery(this),
                sliderId = '#slider-' + $section.data('slider'),
                $slider = jQuery(sliderId);
            if (!$slider.length) return;
            var autoplay = $slider.data('autoplay'),
                autoplaySpeed = $slider.data('speed');
            if (typeof autoplay !== 'undefined' && autoplay !== true && autoplay !== false) autoplay = true;
            if (typeof autoplaySpeed === 'undefined' || autoplaySpeed < 800 || autoplaySpeed > 3000) autoplaySpeed = 2000;
            settings.autoplay = autoplay;
            settings.autoplaySpeed = autoplaySpeed;
            $slider.not('.slick-initialized').slick(settings);
          });
        },
      };
      return new SectionReviews();
    })();
  });
</script>

<style scoped>
  #shopify-section-{{ section.id }} {
    {% if section.settings.enable_custom_margins_paddings %}
      margin-top: {{ section.settings.custom-margin-top }}px;
      margin-bottom: {{ section.settings.custom-margin-bottom }}px;
      padding-top: {{ section.settings.custom-padding-top }}px;
      padding-bottom: {{ section.settings.custom-padding-bottom }}px;
    {% else %}
      margin: 20px 0;
    {% endif %}
  }
</style>
{% schema %}
{
  "name": "Customer Reviews",
  "class": "reviews",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "checkbox",
      "id": "enable_reviews",
      "label": "Show section",
      "default": true
    },
    {
      "type": "text",
      "id": "section_title",
      "label": "Title",
      "default": "Customer Reviews"
    },
    {
      "type": "text",
      "id": "section_subtitle",
      "label": "Subtitle",
      "info": "Optional text below the title"
    },
    {
      "type": "header",
      "content": "Background"
    },
    {
      "type": "select",
      "id": "background_style",
      "label": "Background style",
      "options": [
        { "value": "gradient", "label": "Gradient" },
        { "value": "solid", "label": "Solid" }
      ],
      "default": "gradient"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color (when solid)",
      "default": "#0d0d0d"
    },
    {
      "type": "color",
      "id": "gradient_start",
      "label": "Gradient start color",
      "default": "#0d0d0d"
    },
    {
      "type": "color",
      "id": "gradient_end",
      "label": "Gradient end color",
      "default": "#1a1a1a"
    },
    {
      "type": "header",
      "content": "Slider"
    },
    {
      "type": "checkbox",
      "id": "enable_slider_mobile",
      "label": "Slider on mobile",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_slider_desktop",
      "label": "Slider on desktop",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "slider_autoplay",
      "label": "Autoplay",
      "default": false
    },
    {
      "type": "range",
      "id": "slider_speed",
      "label": "Transition speed (ms)",
      "min": 800,
      "max": 3000,
      "step": 100,
      "unit": "ms",
      "default": 800
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "checkbox",
      "id": "enable_custom_margins_paddings",
      "label": "Custom margins and padding",
      "default": false
    },
    {
      "type": "range",
      "id": "custom-margin-top",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "label": "Margin top",
      "default": 0
    },
    {
      "type": "range",
      "id": "custom-margin-bottom",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "label": "Margin bottom",
      "default": 0
    },
    {
      "type": "range",
      "id": "custom-padding-top",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "label": "Padding top",
      "default": 0
    },
    {
      "type": "range",
      "id": "custom-padding-bottom",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "label": "Padding bottom",
      "default": 0
    },
    {
      "type": "text",
      "id": "custom_class",
      "label": "Custom CSS class"
    }
  ],
  "blocks": [
    {
      "type": "review",
      "name": "Review card",
      "settings": [
        {
          "type": "header",
          "content": "Product image"
        },
        {
          "type": "image_picker",
          "id": "review_product_image",
          "label": "Image",
          "info": "Shown at the top of the card. Leave empty to use theme fallback image."
        },
        {
          "type": "header",
          "content": "Author & rating"
        },
        {
          "type": "text",
          "id": "review_author",
          "label": "Customer name",
          "default": "Sarah M."
        },
        {
          "type": "product",
          "id": "product",
          "label": "Product (for app stars)",
          "info": "If you use a review app, link a product to show its stars. Otherwise manual stars below are used."
        },
        {
          "type": "range",
          "id": "manual_stars_value",
          "label": "Stars (0–5)",
          "min": 0,
          "max": 5,
          "step": 1,
          "default": 5,
          "info": "Used when no review app or no product is selected."
        },
        {
          "type": "header",
          "content": "Review text"
        },
        {
          "type": "richtext",
          "id": "review_text",
          "label": "Comment / description",
          "default": "<p>Best mouse I have ever owned. The build quality is outstanding and it is incredibly comfortable for all-day use.</p>"
        },
        {
          "type": "header",
          "content": "Verified badge"
        },
        {
          "type": "text",
          "id": "review_verified_label",
          "label": "Verified label text",
          "default": "Verified Purchase"
        }
      ]
    },
    {
      "type": "select",
      "name": "Testimonial (legacy)",
      "settings": [
        { "type": "select", "id": "stars_review", "label": "Review Rating", "default": "5", "options": [ { "label": "1", "value": "1" }, { "label": "2", "value": "2" }, { "label": "3", "value": "3" }, { "label": "4", "value": "4" }, { "label": "5", "value": "5" } ] },
        { "type": "text", "id": "title_review", "label": "Review Title" },
        { "type": "richtext", "id": "content_review", "label": "Review Content", "default": "<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>" },
        { "type": "text", "id": "author_review", "label": "Review Author", "default": "John Doe" },
        { "type": "text", "id": "date_review", "label": "Review Date" },
        { "type": "image_picker", "id": "product_image", "label": "Review Image" },
        { "type": "text", "id": "product_review", "label": "Product Title" },
        { "type": "text", "id": "link_product_review", "label": "Product Link" },
        { "type": "product", "id": "product", "label": "Product" }
      ]
    }
  ],
  "presets": [
    {
      "name": "Customer Reviews",
      "category": "Social proof",
      "blocks": [
        { "type": "review", "settings": { "review_author": "Sarah M.", "review_text": "<p>Best mouse I have ever owned. The build quality is outstanding and it is incredibly comfortable for all-day use.</p>" } },
        { "type": "review", "settings": { "review_author": "James K.", "review_text": "<p>Fast shipping and the product exceeded my expectations. Highly recommend for anyone who works from home.</p>" } },
        { "type": "review", "settings": { "review_author": "Emily R.", "review_text": "<p>Worth every penny. Smooth tracking, great battery life, and the design looks premium on my desk.</p>" } }
      ]
    }
  ]
}
{% endschema %}
